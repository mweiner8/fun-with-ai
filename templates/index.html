<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fun with AI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        /* FLEX LAYOUT LIKE ORIGINAL */
        .input-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            background-color: white;
        }

        .input-container {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .text-input-row {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .text-input-row input[type="text"] {
            flex: 1;
        }

        .voice-selector {
            min-width: 120px;
            display: none;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #007bff;
        }

        /* FILE UPLOAD AREA */
        .file-upload-area {
            display: none;
            padding: 15px;
            border: 2px dashed #ccc;
            border-radius: 6px;
            background-color: #fafafa;
            text-align: center;
            margin-top: 5px;
        }

        .file-input {
            display: none;
        }

        .file-label {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        .file-label:hover {
            background-color: #0056b3;
        }

        .file-name {
            display: block;
            margin-top: 8px;
            font-size: 14px;
            color: #555;
        }

        button {
            padding: 12px 24px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            white-space: nowrap;
        }

        button:hover {
            background-color: #0056b3;
        }

        button:active {
            transform: translateY(1px);
        }

        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        /* LOADING MESSAGE STYLES */
        .loading-message {
            display: none;
            background-color: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 4px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            font-size: 18px;
            color: #1976d2;
            font-weight: bold;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e3f2fd;
            border-radius: 50%;
            border-top-color: #2196f3;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .text-display-area {
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 4px;
            padding: 20px;
            min-height: 100px;
            font-size: 16px;
            line-height: 1.5;
            color: #333;
            margin-top: 20px;
        }

        .image-display-area {
            margin-top: 20px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 4px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-display-area img {
            width: 100%;
            height: auto;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* AUDIO PLAYER STYLES */
        .audio-player-area {
            margin-top: 20px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 4px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .play-audio-btn {
            padding: 15px 30px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .play-audio-btn:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .play-audio-btn:active {
            transform: translateY(0);
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: 20px;
        }

        audio {
            display: none;
        }

        /* Responsive for small screens */
        @media (max-width: 600px) {
            .input-form {
                flex-direction: column;
            }

            .audio-player-area {
                flex-direction: column;
            }

            .audio-controls {
                margin-left: 0;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fun with AI</h1>

        <div class="input-section">
            <form method="POST" action="/submit" enctype="multipart/form-data" class="input-form" id="mainForm">
                <label for="processingType"></label>
                <select name="processing_type" id="processingType" required>
                    {% if not option %}
                        <option value="" disabled selected>Select Processing Type</option>
                    {% else %}
                        <option value="" disabled>Select Processing Type</option>
                    {% endif %}

                    {% set processing_types = [
                        ('text_generation', 'Text Generation'),
                        ('image_generation', 'Image Generation'),
                        ('structured_data', 'Structured Data Output (JSON)'),
                        ('vision_capabilities', 'Vision Capabilities'),
                        ('speech_to_text', 'Speech-to-Text'),
                        ('text_to_speech', 'Text-to-Speech')
                    ] %}

                    {% for value, label in processing_types %}
                        {% if option == value %}
                            <option value="{{ value }}" selected>{{ label }}</option>
                        {% else %}
                            <option value="{{ value }}">{{ label }}</option>
                        {% endif %}
                    {% endfor %}
                </select>

                <div class="input-container">
                    <div class="text-input-row">
                        <label for="textInput"></label>
                        <input type="text" name="user_text" id="textInput" placeholder="Enter your text here...">

                        <label for="voiceSelector"></label>
                        <select name="voice_selection" id="voiceSelector" class="voice-selector">
                            {% set voices = [
                                ('alloy', 'Alloy'),
                                ('ash', 'Ash'),
                                ('ballad', 'Ballad'),
                                ('coral', 'Coral'),
                                ('echo', 'Echo'),
                                ('fable', 'Fable'),
                                ('nova', 'Nova'),
                                ('onyx', 'Onyx'),
                                ('sage', 'Sage'),
                                ('shimmer', 'Shimmer')
                            ] %}

                            {% for value, label in voices %}
                                {% if voice == value %}
                                    <option value="{{ value }}" selected>{{ label }}</option>
                                {% else %}
                                    <option value="{{ value }}">{{ label }}</option>
                                {% endif %}
                            {% endfor %}
                        </select>
                    </div>
                    <div class="file-upload-area" id="fileUploadArea">
                        <label for="fileInput" class="file-label">Choose File</label>
                        <input type="file" name="user_file" id="fileInput" class="file-input" accept="image/*">
                        <span id="fileName" class="file-name"></span>
                    </div>
                </div>

                <button type="submit" id="submitBtn">Submit</button>
            </form>
        </div>

        <!-- Loading message -->
        <div class="loading-message" id="loadingMessage">
            <div class="loading-spinner"></div>
            Generating...
        </div>

        {% if text %}
        <div class="text-display-area">
            {{ text }}
        </div>
        {% endif %}

        {% if image %}
        <div class="image-display-area">
            <img src="{{ url_for('static', filename=image) }}?v={{ range(1000000)|random }}" alt="Generated image">
        </div>
        {% endif %}

        {% if audio and option == 'text_to_speech' %}
        <div class="audio-player-area">
            <button class="play-audio-btn" onclick="playAudio()">Play Audio</button>
            <div class="audio-controls">
                <audio id="audioPlayer" preload="auto">
                    <source src="{{ url_for('static', filename=audio) }}?v={{ range(1000000)|random }}" type="audio/mpeg">
                    Your browser does not support the audio element.
                </audio>
                <span id="audioStatus"></span>
            </div>
        </div>
        {% endif %}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const select = document.getElementById('processingType');
            const textInput = document.getElementById('textInput');
            const voiceSelector = document.getElementById('voiceSelector');
            const fileUploadArea = document.getElementById('fileUploadArea');
            const fileInput = document.getElementById('fileInput');
            const fileName = document.getElementById('fileName');
            const form = document.getElementById('mainForm');
            const submitBtn = document.getElementById('submitBtn');
            const loadingMessage = document.getElementById('loadingMessage');

            const placeholders = {
                'text_generation': 'Enter AI prompt...',
                'image_generation': 'Enter image description...',
                'structured_data': 'Describe your product...',
                'text_to_speech': 'Enter text to convert to speech...'
            };

            function updateInputFields() {
                const value = select.value;

                textInput.value = '';
                textInput.style.display = 'block';
                voiceSelector.style.display = 'none';
                fileUploadArea.style.display = 'none';
                textInput.removeAttribute('required');
                fileInput.removeAttribute('required');
                fileName.textContent = '';

                if (value === 'vision_capabilities') {
                    textInput.style.display = 'none';
                    fileUploadArea.style.display = 'block';
                    fileInput.setAttribute('required', 'required');
                    fileInput.setAttribute('accept', 'image/*');
                } else if (value === 'speech_to_text') {
                    textInput.style.display = 'none';
                    fileUploadArea.style.display = 'block';
                    fileInput.setAttribute('required', 'required');
                    fileInput.setAttribute('accept', 'audio/*,video/*');
                } else if (value === 'text_to_speech') {
                    voiceSelector.style.display = 'block';
                    textInput.setAttribute('required', 'required');
                    textInput.placeholder = placeholders[value] || 'Enter your text here...';
                } else if (value) {
                    textInput.setAttribute('required', 'required');
                    textInput.placeholder = placeholders[value] || 'Enter your text here...';
                } else {
                    textInput.placeholder = 'Enter your text here...';
                }
            }

            // Handle form submission
            form.addEventListener('submit', function(e) {
                // Show loading message and disable submit button
                loadingMessage.style.display = 'block';
                submitBtn.disabled = true;
                submitBtn.textContent = 'Processing...';

                // Hide any existing results
                const textArea = document.querySelector('.text-display-area');
                const imageArea = document.querySelector('.image-display-area');
                const audioArea = document.querySelector('.audio-player-area');

                if (textArea) textArea.style.display = 'none';
                if (imageArea) imageArea.style.display = 'none';
                if (audioArea) audioArea.style.display = 'none';
            });

            fileInput.addEventListener('change', function() {
                fileName.textContent = fileInput.files.length > 0 ? fileInput.files[0].name : '';
            });

            select.addEventListener('change', updateInputFields);
            updateInputFields();
        });

        // Audio player functions
        function playAudio() {
            const audio = document.getElementById('audioPlayer');
            const playBtn = document.querySelector('.play-audio-btn');
            const statusSpan = document.getElementById('audioStatus');

            // Force reload the file before playing
            audio.load();

            if (audio.paused) {
                audio.play().then(() => {
                    playBtn.textContent = 'Pause Audio';
                    playBtn.style.backgroundColor = '#dc3545';
                    statusSpan.textContent = 'Playing...';
                }).catch(error => {
                    console.error('Error playing audio:', error);
                    statusSpan.textContent = 'Error playing audio';
                });
            } else {
                audio.pause();
                playBtn.textContent = 'Play Audio';
                playBtn.style.backgroundColor = '#007bff';
                statusSpan.textContent = 'Paused';
            }
        }

        // Audio event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const audio = document.getElementById('audioPlayer');
            if (audio) {
                const playBtn = document.querySelector('.play-audio-btn');
                const statusSpan = document.getElementById('audioStatus');

                audio.addEventListener('ended', function() {
                    playBtn.textContent = 'Play Audio';
                    playBtn.style.backgroundColor = '#007bff';
                    statusSpan.textContent = 'Finished';
                });

                audio.addEventListener('loadstart', function() {
                    statusSpan.textContent = 'Loading...';
                });

                audio.addEventListener('canplay', function() {
                    statusSpan.textContent = 'Ready to play';
                });

                audio.addEventListener('error', function() {
                    statusSpan.textContent = 'Error loading audio';
                });
            }
        });
    </script>
</body>
</html>